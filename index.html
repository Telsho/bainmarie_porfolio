<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bain-marie's portfolio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="image-container">
        <img src="img/base.PNG" alt="background">
        <img src="img/meaple_only.PNG" id="meaple" alt="meaple" style="display: none;">
        <div class="hover-zone" id="blueprints"></div>
        <div class="hover-zone" id="i_liked_blue_after_you"></div>
        <div class="hover-zone" id="seeing_sound"></div>
        <div class="hover-zone" id="to_hold"></div>
        <div class="hover-zone" id="roots"></div>
        <div id="arrow-right"></div>
        <div id="close-btn"></div>
    </div>

    <script>
        const imageContainer = document.getElementById('image-container');
        const mainImage = document.querySelector('#image-container img[alt="background"]');
        const meapleImage = document.getElementById('meaple');
        const hoverZones = document.querySelectorAll('.hover-zone');
        const originalImageSrc = mainImage.src;
        let isAnimating = false;

        const imageMap = {
            'blueprints': 'img/select_blueprints.PNG',
            'i_liked_blue_after_you': 'img/select_I_liked_blue_after_you.PNG',
            'seeing_sound': 'img/select_seeing_sound.PNG',
            'to_hold': 'img/select_to_hold.PNG',
            'roots': 'img/select_roots.PNG'
        };

        function setHoverZonesState(enabled) {
            hoverZones.forEach(hz => {
                hz.style.pointerEvents = enabled ? 'auto' : 'none';
            });
        }

        hoverZones.forEach(zone => {
            zone.addEventListener('mouseover', () => {
                if (!isAnimating) {
                    mainImage.src = imageMap[zone.id];
                }
            });

            zone.addEventListener('mouseout', () => {
                if (!isAnimating) {
                    mainImage.src = originalImageSrc;
                }
            });

            zone.addEventListener('click', () => {
                if (isAnimating) return;

                isAnimating = true;
                setHoverZonesState(false);

                // 1. Instantly change background, show meaple, and start animations
                mainImage.src = 'img/without_meaple.PNG';
                meapleImage.style.display = 'block'; // Show the meaple
                if (zone.id === 'to_hold') {
                    meapleImage.classList.add('spin-and-move');
                } else {
                    meapleImage.classList.add('rotate');
                }
                imageContainer.classList.add('zoomed');

                // 2. After 2 seconds, decide what to do next
                setTimeout(() => {
                    meapleImage.style.display = 'none';
                    meapleImage.classList.remove('rotate', 'spin-and-move');

                    if (zone.id === 'to_hold') {
                        // Change the main image to the GIF
                        mainImage.src = 'img/to_hold_animation.gif';
                        imageContainer.classList.remove('zoomed');

                        // After a delay to let the GIF play, replace it with the static image and show the arrow
                        setTimeout(() => {
                            mainImage.src = 'img/to_hold_1.jpeg';
                            const arrowRight = document.getElementById('arrow-right');
                            const closeBtn = document.getElementById('close-btn');
                            
                            // Show the elements
                            arrowRight.style.display = 'block';
                            closeBtn.style.display = 'block';
                            
                            // Use requestAnimationFrame to apply the animation class on the next frame, ensuring it plays
                            requestAnimationFrame(() => {
                                closeBtn.classList.add('fade-in-animation');
                            });

                            const arrowClickHandler = () => {
                                mainImage.classList.add('rotate-x-animation');
                                arrowRight.style.display = 'none'; // Hide arrow during/after animation

                                mainImage.addEventListener('animationend', () => {
                                    mainImage.src = 'img/to_hold_2.jpeg';
                                    mainImage.classList.remove('rotate-x-animation');
                                }, { once: true });
                            };

                            const closeClickHandler = () => {
                                // 1. Fade out the close button
                                closeBtn.classList.remove('fade-in-animation');
                                closeBtn.classList.add('fade-out-animation');
                                arrowRight.style.display = 'none'; // Hide arrow immediately

                                // 2. Fade out the main image
                                mainImage.classList.add('image-fade-out');

                                // 3. After the image fades out, reset everything and fade the new image in
                                mainImage.addEventListener('animationend', (event) => {
                                    if (event.animationName === 'fade-out') {
                                        // Reset the state
                                        mainImage.src = originalImageSrc;
                                        closeBtn.style.display = 'none';
                                        closeBtn.classList.remove('fade-out-animation');
                                        isAnimating = false;
                                        setHoverZonesState(true);

                                        // Fade the original image back in
                                        mainImage.classList.remove('image-fade-out');
                                        mainImage.classList.add('image-fade-in');

                                        // Clean up the fade-in class after it's done
                                        mainImage.addEventListener('animationend', () => {
                                            mainImage.classList.remove('image-fade-in');
                                        }, { once: true });

                                        // Clean up the main event listeners
                                        arrowRight.removeEventListener('click', arrowClickHandler);
                                        closeBtn.removeEventListener('click', closeClickHandler);
                                    }
                                }, { once: true });
                            };

                            arrowRight.addEventListener('click', arrowClickHandler);
                            closeBtn.addEventListener('click', closeClickHandler);
                        }, 3000); // NOTE: Adjust this duration to match your GIF's length

                    } else {
                        // Original behavior for other zones
                        imageContainer.classList.remove('zoomed');
                        mainImage.src = originalImageSrc; // Optional: reset to original image
                        isAnimating = false;
                        setHoverZonesState(true);
                    }
                }, 2000);
            });
        });
    </script>
</body>
</html>
